---
title: "记忆系统架构"
date: 2026-02-26
category: lessons
priority: 🔴
status: active
last_verified: 2026-02-26
tags: [memory, architecture, openclaw]
---

# 记忆系统架构指南

## 核心原则

> **文件 = 事实来源。你不写进文件的东西 = 你从来不知道的东西。**

## 三层架构

```
┌─────────────────────────────────────────────────────────┐
│  短期层: NOW.md                                          │
│  - Agent的"工作台"，记录当前状态、优先级、阻塞项           │
│  - 每次对话覆写，不追加                                   │
│  - 只保留当天的完成项                                     │
└─────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────┐
│  中期层: 每日日志 (memory/YYYY-MM-DD.md)                  │
│  - 事件流水，记录当天发生的一切                            │
│  - 追加式写入，永不覆写                                   │
│  - 格式: ### HH:MM — Title                               │
└─────────────────────────────────────────────────────────┘
                            ↓ (每晚 23:45 反思)
┌─────────────────────────────────────────────────────────┐
│  长期层: INDEX.md → 结构化子目录                          │
│  - lessons/ - 可复用经验                                  │
│  - decisions/ - 战略决策                                  │
│  - people/ - 人物画像                                     │
│  - projects/ - 项目追踪                                   │
└─────────────────────────────────────────────────────────┘
```

## 写入机制

### 1. 日志写入 (memlog)
- 所有事件、完成、决策 → memory/YYYY-MM-DD.md
- 追加式写入，自动时间戳

### 2. 知识写入 (CRUD)
- 先读再写，避免重复和冲突
- 分类: [LESSON] / [PERSON] / [DECISION]

### 3. 状态更新 (NOW)
- 每次对话结束时更新 NOW.md
- 覆写式，只保留当前状态

## 检索机制

| 级别 | 方式 | 适用场景 |
|------|------|----------|
| L1 | 扫 INDEX.md | 知道要找什么类别 |
| L2 | 直接读目标文件 | 已知具体路径 |
| L3 | 语义搜索 | 模糊查询 |

## 生命周期

```
日间: 实时写入 (heartbeat / 对话)
    ↓
23:30: 日志同步 (补漏)
    ↓
23:45: 夜间反思 (提炼 + CRUD)
    ↓
周日 00:00: GC 归档 (冷数据)
```

## Frontmatter 规范

```yaml
---
title: "标题"
date: 2026-02-26
category: lessons | decision | person
priority: 🔴 | 🟡 | ⚪
status: active | superseded | conflict
last_verified: 2026-02-26
tags: [tag1, tag2]
---
```

## 状态流转

```
active ──→ superseded (被更新版本取代)
active ──→ conflict (发现矛盾，待裁决)
conflict ──→ active (人工裁决后恢复)
```

---

*参考: Ray Wang "OpenClaw 记忆管理，从入门到高阶完整实战指南"*
